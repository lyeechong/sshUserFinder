#!/usr/bin/perl

use strict;
use warnings;
use Net::SSH::Perl;

my $filename = 'loginData.dat';

open(my $fh, $filename) or die "Could not open the file '$filename' $!";

my $linecount = 0;
my $username = 'DEFAULT';
my $hostname = 'DEFAULT';
my $password = 'DEFAULT';

while(my $line = <$fh>)
{
	chomp $line;
	if($linecount == 0)
	{	
		# -- username
		$username = $line;
	}
	elsif($linecount == 1)
	{
		# -- hostname
		$hostname = $line;
	}
	elsif($linecount == 2)
	{
		$password = $line;
		
		my $ssh = Net::SSH::Perl->new(
        $host,
        protocol => '2,1',
        debug    => 1,
    );
    $ssh->login( $username, $password );
	}
	else
	{
		# -- other lines: commands to execute
		print $line, "\n";
	}
	$linecount++;
}

if($hostname eq 'DEFAULT' or $username eq 'DEFAULT' or $password eq 'DEFAULT')
{
	die "The textfile read the user/pass/host incorrectly! $!\n";
}

print "Hostname is: ", $hostname, "\n";
print "Username is: ", $username, "\n";
print "Password is: ", $password, "\n";

sub runCommand
{
    my $cmd = $_;
    my ( $stdout, $stderr, $exit ) = $ssh->cmd($cmd);
    print $stdout, "\n";    
}
